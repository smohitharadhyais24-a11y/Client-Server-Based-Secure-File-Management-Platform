<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operating System File Server Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #fff;
            line-height: 1.6;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ==================== HEADER ==================== */
        .dashboard-header {
            background: rgba(30, 45, 70, 0.95);
            border-radius: 8px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-left: 4px solid #4a90e2;
        }

        .header-content h1 {
            font-size: 1.8em;
            color: #fff;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-content p {
            color: #a0b0c8;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .client-info {
            background: rgba(74, 144, 226, 0.2);
            border: 1px solid rgba(74, 144, 226, 0.3);
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #fff;
        }

        .threat-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .threat-normal { background: rgba(76, 175, 80, 0.2); color: #81c784; border: 1px solid rgba(76, 175, 80, 0.3); }
        .threat-high { background: rgba(255, 152, 0, 0.2); color: #ffb74d; border: 1px solid rgba(255, 152, 0, 0.3); }
        .threat-critical { background: rgba(244, 67, 54, 0.2); color: #e57373; border: 1px solid rgba(244, 67, 54, 0.3); }

        .threat-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ==================== GRID LAYOUT ==================== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 45, 70, 0.9);
            border: 1px solid rgba(74, 144, 226, 0.2);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .panel h2 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel h3 {
            color: #a0b0c8;
            margin: 15px 0 10px 0;
            font-size: 0.95em;
            font-weight: 600;
        }

        /* ==================== STATUS CARDS ==================== */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: rgba(74, 144, 226, 0.15);
            border: 1px solid rgba(74, 144, 226, 0.3);
            border-radius: 6px;
            padding: 18px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            border-color: #4a90e2;
            background: rgba(74, 144, 226, 0.25);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4a90e2;
            text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
        }

        .stat-label {
            font-size: 0.75em;
            color: #a0b0c8;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ==================== TABLES ==================== */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        thead {
            background: rgba(74, 144, 226, 0.2);
            border-bottom: 2px solid #4a90e2;
        }

        th {
            padding: 10px;
            text-align: left;
            color: #fff;
            font-weight: 600;
            font-size: 0.9em;
        }

        td {
            padding: 8px 10px;
            border-bottom: 1px solid rgba(74, 144, 226, 0.1);
            color: #a0b0c8;
            font-size: 0.85em;
        }

        tbody tr:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .lock-read { background: rgba(76, 175, 80, 0.2); color: #81c784; }
        .lock-write { background: rgba(244, 67, 54, 0.2); color: #e57373; }

        .severity-info { color: #4fc3f7; }
        .severity-medium { color: #ffb74d; }
        .severity-high { color: #ff8a65; }
        .severity-critical { color: #e57373; font-weight: bold; }

        /* ==================== EVENT FEED ==================== */
        .event-feed {
            background: rgba(20, 30, 48, 0.6);
            border: 1px solid rgba(74, 144, 226, 0.2);
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.8em;
        }

        .event-line {
            padding: 4px 0;
            border-bottom: 1px solid rgba(74, 144, 226, 0.1);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #a0b0c8;
        }

        .event-time {
            color: #4fc3f7;
            margin-right: 10px;
        }

        .event-type {
            color: #ffb74d;
            margin-right: 10px;
            font-weight: 600;
            min-width: 100px;
            display: inline-block;
        }

        /* ==================== BUTTONS ==================== */
        button {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            border: 1px solid rgba(74, 144, 226, 0.5);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Segoe UI', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px 5px 5px 0;
            font-size: 0.9em;
        }

        button:hover {
            background: linear-gradient(135deg, #357abd 0%, #2968a8 100%);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
            transform: translateY(-2px);
        }

        button:active {
            transform: scale(0.98);
        }

        button.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border: 1px solid rgba(231, 76, 60, 0.5);
            color: white;
        }

        button.danger:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        /* ==================== AUDIT TIMELINE SCROLLABLE ==================== */
        .audit-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .audit-filter-btn {
            padding: 6px 12px;
            font-size: 0.8em;
            background: rgba(74, 144, 226, 0.15);
            border: 1px solid rgba(74, 144, 226, 0.3);
            transition: all 0.2s;
        }
        
        .audit-filter-btn.active {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            border: 1px solid rgba(74, 144, 226, 0.8);
        }
        
        .audit-table-container {
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid rgba(74, 144, 226, 0.2);
            border-radius: 4px;
        }
        
        .audit-table-container table {
            margin: 0;
        }
        
        .audit-table-container thead {
            position: sticky;
            top: 0;
            background: rgba(30, 45, 70, 0.95);
            z-index: 10;
        }
        
        /* Row color coding */
        tr.audit-success { background: rgba(76, 175, 80, 0.05); border-left: 3px solid #81c784; }
        tr.audit-failed { background: rgba(244, 67, 54, 0.05); border-left: 3px solid #e57373; }
        tr.audit-lock { background: rgba(33, 150, 243, 0.05); border-left: 3px solid #64b5f6; }
        
        /* ==================== COMBINED FILE OPERATIONS ==================== */
        .file-ops-combined {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .file-ops-combined {
                grid-template-columns: 1fr;
            }
        }
        
        .file-ops-section {
            background: rgba(74, 144, 226, 0.05);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid rgba(74, 144, 226, 0.2);
        }
        
        /* ==================== WIDE PANELS ==================== */
        .panel-wide {
            grid-column: 1 / -1;
        }

        /* ==================== INPUT FIELDS ==================== */
        input[type="text"],
        input[type="password"],
        input[type="file"],
        textarea {
            background: rgba(20, 30, 48, 0.6);
            color: #fff;
            border: 1px solid rgba(74, 144, 226, 0.3);
            padding: 10px;
            border-radius: 4px;
            font-family: 'Segoe UI', sans-serif;
            margin: 5px 0;
            width: 100%;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        input[type="file"]:focus,
        textarea:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
            outline: none;
            background: rgba(20, 30, 48, 0.8);
        }

        input::placeholder,
        textarea::placeholder {
            color: #6c7a89;
        }

        /* ==================== OS CONCEPTS BOX ==================== */
        .os-concepts {
            background: rgba(74, 144, 226, 0.1);
            border-left: 4px solid #4a90e2;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .os-concepts h4 {
            color: #4a90e2;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .os-concepts ul {
            list-style: none;
            color: #a0b0c8;
            font-size: 0.85em;
        }

        .os-concepts li:before {
            content: "‚ñ∏ ";
            color: #4a90e2;
            margin-right: 5px;
            font-weight: bold;
        }

        /* ==================== MODALS ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(30, 45, 70, 0.98);
            border: 2px solid rgba(74, 144, 226, 0.5);
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .modal-content h2 {
            color: #fff;
            margin-bottom: 15px;
        }

        .modal-content p {
            color: #a0b0c8;
            margin-bottom: 15px;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content h1 {
                font-size: 1.8em;
            }

            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- ==================== HEADER ==================== -->
        <div class="dashboard-header">
            <div class="header-content">
                <h1>üñ•Ô∏è Client‚ÄìServer Based Secure File Management Platform using UNIX File System Concepts</h1>
                <p>Real-time OS-level file operations monitoring, locking, and deadlock visualization</p>
            </div>
            <div class="header-controls">
                <div class="client-info">
                    üë§ Client: <span id="username">anonymous</span> | 
                    <span id="sessionStatus">Session: <span class="status-disconnected">offline</span></span>
                </div>
                <div id="threatLevel" class="threat-indicator threat-normal">
                    <span class="threat-dot"></span>
                    <span>SECURE</span>
                </div>
                <div style="padding: 8px 15px; background: rgba(76, 175, 80, 0.15); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 4px; font-size: 0.9em;">
                    <span id="serverStatus" class="status-connected" style="color: #81c784;">‚úì C Server Connected</span>
                    <span style="font-size: 0.8em; color: #a0b0c8; margin-left: 5px;">:8888</span>
                </div>
                <button onclick="window.location.href='demo.html'" style="background: rgba(255, 193, 7, 0.2); border-color: #ffc107; color: #ffc107;">üé¨ Demo Mode</button>
                <button onclick="logout()">üîê Logout</button>
            </div>
        </div>

        <!-- ==================== MAIN GRID ==================== -->
        <div class="dashboard-grid">

            <!-- ROW 1, LEFT: SYSTEM STATUS -->
            <div class="panel">
                <h2>üìä System Status</h2>
                <p style="color: #a0b0c8; font-size: 0.85em;">Click cards to run OS commands</p>
                
                <!-- Row 1: Files, Storage, Locks -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 12px;">
                    <div class="stat-card" onclick="runOSCommand('files')">
                        <div class="stat-value" id="fileCount">0</div>
                        <div class="stat-label">Files Stored</div>
                        <div style="font-size: 0.65em; color: #6c7a89; margin-top: 5px;">ls storage/</div>
                    </div>
                    <div class="stat-card" onclick="runOSCommand('storage')">
                        <div class="stat-value" id="storageUsed">0 MB</div>
                        <div class="stat-label">Total Storage</div>
                        <div style="font-size: 0.65em; color: #6c7a89; margin-top: 5px;">du -sh storage/</div>
                    </div>
                    <div class="stat-card" onclick="runOSCommand('locks')">
                        <div class="stat-value" id="lockCount">0</div>
                        <div class="stat-label">Active Locks</div>
                        <div style="font-size: 0.65em; color: #6c7a89; margin-top: 5px;">fcntl(F_GETLK)</div>
                    </div>
                </div>

                <!-- Row 2: Clients, Audit Logs, Security -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 15px;">
                    <div class="stat-card" onclick="runOSCommand('clients')">
                        <div class="stat-value" id="clientCount">1</div>
                        <div class="stat-label">Active Clients</div>
                        <div style="font-size: 0.65em; color: #6c7a89; margin-top: 5px;">who | wc -l</div>
                    </div>
                    <div class="stat-card" onclick="runOSCommand('audit')">
                        <div class="stat-value" id="auditCount">0</div>
                        <div class="stat-label">Audit Logs</div>
                        <div style="font-size: 0.65em; color: #6c7a89; margin-top: 5px;">wc -l audit.log</div>
                    </div>
                    <div class="stat-card" onclick="runOSCommand('security')">
                        <div class="stat-value" id="threatCount">0</div>
                        <div class="stat-label">Security Alerts</div>
                        <div style="font-size: 0.65em; color: #6c7a89; margin-top: 5px;">grep FAIL audit.log</div>
                    </div>
                </div>

                <!-- Advanced OS Status -->
                <h3 style="color: #4a90e2; font-size: 0.95em; margin-bottom: 10px;">üßµ Advanced OS Status</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 15px;">
                    <div class="stat-card" style="background: rgba(74, 144, 226, 0.08);" onclick="runOSCommand('threads')">
                        <div class="stat-value" id="threadCount" style="font-size: 1.4em;">-</div>
                        <div class="stat-label" style="font-size: 0.8em;">Server Threads</div>
                        <div style="font-size: 0.6em; color: #6c7a89; margin-top: 5px;">pthread_active</div>
                    </div>
                    <div class="stat-card" style="background: rgba(74, 144, 226, 0.08);" onclick="runOSCommand('uptime')">
                        <div class="stat-value" id="serverUptime" style="font-size: 1.4em;">0s</div>
                        <div class="stat-label" style="font-size: 0.8em;">Server Uptime</div>
                        <div style="font-size: 0.6em; color: #6c7a89; margin-top: 5px;">time(NULL) - start</div>
                    </div>
                </div>

                <!-- Deadlock & Stability -->
                <h3 style="color: #ffc107; font-size: 0.95em; margin-bottom: 10px;">üß™ Deadlock & Stability</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 15px;">
                    <div class="stat-card" style="background: rgba(255, 193, 7, 0.08);" onclick="runOSCommand('blocked')">
                        <div class="stat-value" id="blockedOps" style="font-size: 1.4em;">0</div>
                        <div class="stat-label" style="font-size: 0.8em;">Blocked Operations</div>
                        <div style="font-size: 0.6em; color: #6c7a89; margin-top: 5px;">Deadlock avoidance</div>
                    </div>
                    <div class="stat-card" style="background: rgba(255, 193, 7, 0.08);" onclick="runOSCommand('recovered')">
                        <div class="stat-value" id="recoveredOps" style="font-size: 1.4em;">0</div>
                        <div class="stat-label" style="font-size: 0.8em;">Recovered Operations</div>
                        <div style="font-size: 0.6em; color: #6c7a89; margin-top: 5px;">Timeout recovery</div>
                    </div>
                </div>

                <!-- COMMAND OUTPUT TERMINAL -->
                <div id="commandOutput" style="margin-top: 15px; background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(74, 144, 226, 0.3); border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; font-size: 0.8em; color: #00ff00; max-height: 150px; overflow-y: auto; display: none;">
                    <div style="color: #4a90e2; font-weight: bold; margin-bottom: 5px;">‚ùØ Command Output:</div>
                    <div id="commandText" style="white-space: pre-wrap; line-height: 1.6;"></div>
                </div>
            </div>

            <!-- ROW 1, RIGHT: FILE OPERATIONS -->
            <div class="panel">
                <h2>üìÅ File Operations & Current Files</h2>
                <p style="color: #a0b0c8; font-size: 0.8em; margin-bottom: 10px;">
                    <strong>OS Flow:</strong> <code style="color: #4a90e2;">open() ‚Üí fcntl(F_WRLCK/F_RDLCK) ‚Üí read/write() ‚Üí close()</code>
                </p>

                <!-- Upload Operations Section -->
                <div style="background: rgba(255, 87, 34, 0.08); padding: 10px; border-radius: 6px; border-left: 3px solid #ff5722; margin-bottom: 10px;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 1.2em; margin-right: 6px;">üîê</span>
                        <div>
                            <h3 style="margin: 0; color: #ff7043; font-size: 0.9em; font-weight: 700;">Upload / Create File</h3>
                            <div style="font-size: 0.7em; color: #ff8a65; font-weight: 600;">WRITE LOCK (F_WRLCK)</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px;">
                        <!-- Upload from Device -->
                        <div>
                            <div style="font-weight: 600; color: #fff; margin-bottom: 4px; font-size: 0.8em;">From Device:</div>
                            <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(event)" />
                            <button onclick="document.getElementById('fileInput').click()" style="width: 100%; padding: 7px; font-size: 0.75em; margin-bottom: 3px;">
                                üìÇ Choose File
                            </button>
                            <div id="selectedFileInfo" style="color: #a0b0c8; font-size: 0.7em; margin-bottom: 3px; display: none; text-align: center;">
                                <span id="selectedFileName"></span> (<span id="selectedFileSize"></span>)
                            </div>
                            <button onclick="uploadSelectedFile()" id="uploadBtn" style="width: 100%; padding: 7px; font-size: 0.75em; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);" disabled>
                                ‚¨ÜÔ∏è Upload
                            </button>
                        </div>

                        <!-- Upload Text Content -->
                        <div>
                            <div style="font-weight: 600; color: #fff; margin-bottom: 4px; font-size: 0.8em;">Manual Text:</div>
                            <input type="text" id="uploadName" placeholder="filename.txt" style="width: 100%; margin-bottom: 3px; padding: 5px; font-size: 0.75em;" />
                            <textarea id="uploadContent" placeholder="Content..." rows="2" style="width: 100%; margin-bottom: 3px; padding: 5px; font-size: 0.75em; resize: none;"></textarea>
                            <button onclick="uploadFile()" style="width: 100%; padding: 7px; font-size: 0.75em;">‚¨ÜÔ∏è Create File</button>
                        </div>
                    </div>

                    <div style="padding: 5px; background: rgba(0,0,0,0.3); border-radius: 3px; font-size: 0.7em; color: #a0b0c8; text-align: center;">
                        <strong>OS:</strong> open() ‚Üí fcntl(W) ‚Üí write() ‚Üí close()
                    </div>
                </div>

                <!-- Current Files Section -->
                <div style="background: rgba(0, 0, 0, 0.25); padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <h3 style="margin: 0; color: #fff; font-size: 0.9em; font-weight: 700;">üìÇ Current Files (storage/)</h3>
                        <button onclick="refreshFileList()" style="padding: 4px 10px; font-size: 0.7em; background: rgba(74, 144, 226, 0.3); border-radius: 3px;">
                            üîÑ Refresh
                        </button>
                    </div>
                    
                    <div id="fileListContainer" style="max-height: 160px; overflow-y: auto; background: rgba(0, 0, 0, 0.4); padding: 8px; border-radius: 4px; font-size: 0.75em; margin-bottom: 6px;">
                        <div style="color: #a0b0c8; text-align: center; padding: 10px; font-size: 0.9em;">
                            [No files yet]<br>
                            <span style="font-size: 0.85em; color: #6c7a89;">Upload files to see them listed here</span>
                        </div>
                    </div>

                    <div style="padding: 5px; background: rgba(0,0,0,0.3); border-radius: 3px; font-size: 0.7em; color: #a0b0c8; text-align: center;">
                        <strong>OS:</strong> readdir() ‚Üí stat()
                    </div>
                </div>

                <!-- Download/Delete Operations -->
                <div style="background: rgba(74, 144, 226, 0.08); padding: 10px; border-radius: 6px; border-left: 3px solid #4a90e2;">
                    <h3 style="margin: 0 0 8px 0; color: #4a90e2; font-size: 0.9em; font-weight: 700;">File Access Operations</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px;">
                        <!-- Download (READ) -->
                        <div style="padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 4px;">
                            <div style="display: flex; align-items: center; margin-bottom: 4px;">
                                <span style="font-size: 1em; margin-right: 4px;">üîì</span>
                                <span style="font-size: 0.7em; color: #81c784; font-weight: 600;">READ LOCK (F_RDLCK)</span>
                            </div>
                            <input type="text" id="downloadName" placeholder="filename.txt" style="width: 100%; margin-bottom: 4px; padding: 5px; font-size: 0.75em;" />
                            <button onclick="downloadFile()" style="width: 100%; padding: 6px; font-size: 0.75em; background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);">
                                üì• Download
                            </button>
                        </div>

                        <!-- Delete (WRITE) -->
                        <div style="padding: 8px; background: rgba(244, 67, 54, 0.1); border-radius: 4px;">
                            <div style="display: flex; align-items: center; margin-bottom: 4px;">
                                <span style="font-size: 1em; margin-right: 4px;">‚ùå</span>
                                <span style="font-size: 0.7em; color: #e57373; font-weight: 600;">WRITE LOCK REQUIRED</span>
                            </div>
                            <input type="text" id="deleteName" placeholder="filename.txt" style="width: 100%; margin-bottom: 4px; padding: 5px; font-size: 0.75em;" />
                            <button class="danger" onclick="deleteFile()" style="width: 100%; padding: 6px; font-size: 0.75em;">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>

                    <div style="padding: 5px; background: rgba(0,0,0,0.3); border-radius: 3px; font-size: 0.7em; color: #a0b0c8; text-align: center;">
                        <strong>OS:</strong> read() / unlink()
                    </div>
                </div>

                <!-- OPERATION OUTPUT / STATUS -->
                <div id="operationStatus" style="margin-top: 10px; padding: 8px; background: rgba(76, 175, 80, 0.15); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 4px; display: none;">
                    <div style="font-weight: bold; color: #fff; margin-bottom: 3px; font-size: 0.8em;">üìä Operation Status:</div>
                    <div id="operationMessage" style="color: #81c784; font-family: 'Courier New', monospace; font-size: 0.75em;"></div>
                </div>
            </div>

            <!-- ROW 2, LEFT: FILE LOCKING STATE -->
            <div class="panel">
                <h2>üîí File Locking State</h2>
                <p style="color: #a0b0c8; font-size: 0.85em;">Real-time file locking with deadlock handling</p>

                <table>
                    <thead>
                        <tr>
                            <th>File</th>
                            <th>Lock Type</th>
                            <th>Owner</th>
                            <th>PID</th>
                        </tr>
                    </thead>
                    <tbody id="lockTable">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #a0b0c8;">[No active locks]</td>
                        </tr>
                    </tbody>
                </table>

                <h3 style="margin-top: 15px;">Lock Statistics</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <div style="background: rgba(76, 175, 80, 0.15); padding: 15px; border-radius: 4px; border-left: 4px solid #81c784;">
                        <div style="color: #81c784; font-weight: 600; font-size: 0.85em;">READ LOCKS</div>
                        <div style="font-size: 1.8em; color: #81c784; font-weight: bold;" id="readLockCount">0</div>
                    </div>
                    <div style="background: rgba(244, 67, 54, 0.15); padding: 15px; border-radius: 4px; border-left: 4px solid #e57373;">
                        <div style="color: #e57373; font-weight: 600; font-size: 0.85em;">WRITE LOCKS</div>
                        <div style="font-size: 1.8em; color: #e57373; font-weight: bold;" id="writeLockCount">0</div>
                    </div>
                </div>

                <!-- Deadlock Explanations -->
                <div style="margin-top: 15px; padding: 15px; background: rgba(74, 144, 226, 0.1); border-left: 4px solid #4a90e2; border-radius: 4px;">
                    <h4 style="color: #4a90e2; margin-bottom: 10px; font-size: 0.95em;">‚öôÔ∏è Deadlock Handling</h4>
                    <div style="font-size: 0.85em; color: #a0b0c8; line-height: 1.7;">
                        <p style="margin: 0 0 8px 0;"><strong style="color: #81c784;">‚Ä¢ Prevention:</strong> Resource ordering and bounded waiting</p>
                        <p style="margin: 0 0 8px 0;"><strong style="color: #ba68c8;">‚Ä¢ Avoidance:</strong> Non-blocking fcntl(F_SETLK) operations</p>
                        <p style="margin: 0;"><strong style="color: #e57373;">‚Ä¢ Recovery:</strong> Timeout-based cleanup with select()</p>
                    </div>
                </div>
            </div>

            <!-- ROW 2, RIGHT: SECURITY ALERTS -->
            <div class="panel">
                <h2>‚ö†Ô∏è Security Alerts</h2>
                <p style="color: #a0b0c8; font-size: 0.85em;">Latest intrusion and violation detection</p>

                <div style="margin-bottom: 10px;">
                    <button onclick="refreshSecurityEvents()" style="padding: 4px 8px; font-size: 0.85em;">Refresh Threats</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Threat Type</th>
                            <th>Severity</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="threatTable">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #81c784;">[Currently safe. No threats detected]</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 10px; padding: 8px; background: rgba(76, 175, 80, 0.1); border-left: 3px solid #81c784; font-size: 0.85em;">
                    <strong style="color: #81c784;">Security Monitoring:</strong> Path traversal, concurrent access, integrity checks
                </div>
            </div>

            <!-- ROW 3, LEFT: OS AUDIT TIMELINE -->
            <div class="panel">
                <h2>üìã OS Audit Timeline</h2>
                <p style="color: #a0b0c8; font-size: 0.85em;">Timestamped logs of all file system operations with filters</p>

                <!-- FILTER TABS -->
                <div class="audit-filters">
                    <button class="audit-filter-btn active" onclick="filterAudit('all')">All</button>
                    <button class="audit-filter-btn" onclick="filterAudit('upload')">Uploads</button>
                    <button class="audit-filter-btn" onclick="filterAudit('download')">Downloads</button>
                    <button class="audit-filter-btn" onclick="filterAudit('delete')">Deletes</button>
                    <button class="audit-filter-btn" onclick="filterAudit('lock')">Locks</button>
                    <button class="audit-filter-btn" onclick="filterAudit('failed')">Failed / Security</button>
                    <button onclick="refreshAuditLog()" style="padding: 6px 12px; font-size: 0.8em; margin-left: auto;">üîÑ Refresh</button>
                    <button onclick="clearAuditLog()" style="padding: 6px 12px; font-size: 0.8em; background: rgba(255, 87, 34, 0.2); border-color: #ff5722;" title="Clear all audit history">üóëÔ∏è Clear History</button>
                </div>

                <!-- SCROLLABLE TABLE CONTAINER -->
                <div class="audit-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Operation</th>
                                <th>File</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="auditTable">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #6c757d;">[No logs yet]</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="os-concepts" style="margin-top: 15px;">
                    <h4>üéì OS Concepts:</h4>
                    <p style="color: #a0b0c8; font-size: 0.85em; margin: 0;">System call tracing, audit trail, timestamps, event logging for forensic analysis</p>
                </div>
            </div>

            <!-- ROW 3, RIGHT: OS CONCEPTS DEMONSTRATED -->
            <div class="panel">
                <h2>üéì OS Concepts Demonstrated</h2>
                <p style="color: #a0b0c8; font-size: 0.85em;">Core operating system concepts implemented in this project</p>

                <!-- CARD-BASED GRID LAYOUT -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; margin-top: 20px;">
                    <!-- Card 1: UNIX File I/O -->
                    <div style="background: linear-gradient(135deg, rgba(74, 144, 226, 0.15), rgba(74, 144, 226, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(74, 144, 226, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üíæ</div>
                        <h3 style="color: #4a90e2; margin-bottom: 10px; font-size: 1.1em;">UNIX File I/O</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            Low-level file operations using <code style="color: #fff;">open()</code>, <code style="color: #fff;">read()</code>, <code style="color: #fff;">write()</code>, and <code style="color: #fff;">close()</code> system calls with file descriptors.
                        </p>
                    </div>

                    <!-- Card 2: File Locking -->
                    <div style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 193, 7, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(255, 193, 7, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üîí</div>
                        <h3 style="color: #ffc107; margin-bottom: 10px; font-size: 1.1em;">File Locking (fcntl)</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            Advisory locking using <code style="color: #fff;">fcntl()</code> with <code style="color: #fff;">F_RDLCK</code> (read), <code style="color: #fff;">F_WRLCK</code> (write), and <code style="color: #fff;">F_UNLCK</code> (unlock) modes.
                        </p>
                    </div>

                    <!-- Card 3: Deadlock Prevention -->
                    <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(76, 175, 80, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üõ°Ô∏è</div>
                        <h3 style="color: #81c784; margin-bottom: 10px; font-size: 1.1em;">Deadlock Prevention</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            Resource ordering and bounded waiting ensure safe resource allocation using lock hierarchies and non-blocking operations.
                        </p>
                    </div>

                    <!-- Card 4: Deadlock Avoidance -->
                    <div style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.15), rgba(156, 39, 176, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(156, 39, 176, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üîç</div>
                        <h3 style="color: #ba68c8; margin-bottom: 10px; font-size: 1.1em;">Deadlock Avoidance</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            Non-blocking <code style="color: #fff;">F_SETLK</code> operations detect conflicts immediately, allowing clients to retry or abort safely.
                        </p>
                    </div>

                    <!-- Card 5: Deadlock Recovery -->
                    <div style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.15), rgba(244, 67, 54, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(244, 67, 54, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">‚è±Ô∏è</div>
                        <h3 style="color: #e57373; margin-bottom: 10px; font-size: 1.1em;">Deadlock Recovery</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            Timeout-based recovery using <code style="color: #fff;">select()</code> detects stalled clients and automatically releases orphaned locks.
                        </p>
                    </div>

                    <!-- Card 6: Multi-threading -->
                    <div style="background: linear-gradient(135deg, rgba(0, 188, 212, 0.15), rgba(0, 188, 212, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(0, 188, 212, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üßµ</div>
                        <h3 style="color: #4dd0e1; margin-bottom: 10px; font-size: 1.1em;">Multi-threading</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            POSIX threads (<code style="color: #fff;">pthreads</code>) handle concurrent clients with mutex and semaphore synchronization primitives.
                        </p>
                    </div>

                    <!-- Card 7: TCP Socket IPC -->
                    <div style="background: linear-gradient(135deg, rgba(255, 87, 34, 0.15), rgba(255, 87, 34, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(255, 87, 34, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üì°</div>
                        <h3 style="color: #ff7043; margin-bottom: 10px; font-size: 1.1em;">TCP Socket IPC</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            Berkeley sockets for inter-process communication using <code style="color: #fff;">socket()</code>, <code style="color: #fff;">bind()</code>, <code style="color: #fff;">listen()</code>, and <code style="color: #fff;">accept()</code>.
                        </p>
                    </div>

                    <!-- Card 8: Audit Logging -->
                    <div style="background: linear-gradient(135deg, rgba(121, 85, 72, 0.15), rgba(121, 85, 72, 0.05)); padding: 20px; border-radius: 8px; border: 1px solid rgba(121, 85, 72, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üìã</div>
                        <h3 style="color: #a1887f; margin-bottom: 10px; font-size: 1.1em;">Audit Logging</h3>
                        <p style="color: #a0b0c8; font-size: 0.85em; line-height: 1.6;">
                            Timestamped system call tracing with operation logs for security monitoring and forensic analysis.
                        </p>
                    </div>
                </div>
            </div>

        </div> <!-- Close dashboard-grid -->

        <!-- ==================== DEMO / EXPLAIN MODE ==================== -->
        <div class="panel" style="margin-top: 30px;">
            <h2>üí° Demo / Explain Mode</h2>
            <p style="color: #a0b0c8; font-size: 0.85em;">Step-by-step guide for demonstrating OS concepts to evaluators</p>

            <div style="background: rgba(74, 144, 226, 0.1); padding: 15px; border-radius: 4px; border-left: 4px solid #4a90e2; margin: 15px 0;">
                <h3 style="color: #4a90e2; margin-bottom: 10px;">üìù How to Demonstrate:</h3>
                <ol style="color: #a0b0c8; font-size: 0.9em; line-height: 1.8; padding-left: 20px;">
                    <li><strong style="color: #fff;">Upload a file</strong> ‚Äî Creates new WRITE lock + audit trail entry (see System Status update)</li>
                    <li><strong style="color: #fff;">Check Server Connection</strong> ‚Äî Verify both C Server (8888) and Flask API (5000) are running</li>
                    <li><strong style="color: #fff;">Multiple clients</strong> ‚Äî Several clients can view same file simultaneously (Multiple READ locks!)</li>
                    <li><strong style="color: #fff;">Try lock conflict</strong> ‚Äî Attempt to write while others are reading (deadlock detection in action)</li>
                    <li><strong style="color: #fff;">Delete operation</strong> ‚Äî Security alert if lock not released first (check Security Alerts panel)</li>
                    <li><strong style="color: #fff;">Review audit log</strong> ‚Äî Use filter tabs to view operations by category (All/Uploads/Downloads/Locks/Security)</li>
                </ol>
            </div>

            <div style="margin-top: 20px;">
                <h3 style="color: #4a90e2; margin-bottom: 10px;">üìö OS Concepts Demonstrated:</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: rgba(74, 144, 226, 0.1); padding: 12px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">üîí</div>
                        <div style="color: #fff; font-weight: 600; font-size: 0.9em;">POSIX Locking</div>
                        <div style="color: #a0b0c8; font-size: 0.75em;">fcntl(), advisory locks</div>
                    </div>
                    <div style="background: rgba(74, 144, 226, 0.1); padding: 12px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">‚öôÔ∏è</div>
                        <div style="color: #fff; font-weight: 600; font-size: 0.9em;">Multi-threading</div>
                        <div style="color: #a0b0c8; font-size: 0.75em;">pthread, concurrent access</div>
                    </div>
                    <div style="background: rgba(74, 144, 226, 0.1); padding: 12px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">‚õìÔ∏è</div>
                        <div style="color: #fff; font-weight: 600; font-size: 0.9em;">Deadlock Detection</div>
                        <div style="color: #a0b0c8; font-size: 0.75em;">Resource wait graph</div>
                    </div>
                    <div style="background: rgba(74, 144, 226, 0.1); padding: 12px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">üìã</div>
                        <div style="color: #fff; font-weight: 600; font-size: 0.9em;">Audit Logging</div>
                        <div style="color: #a0b0c8; font-size: 0.75em;">Timestamps, client tracking</div>
                    </div>
                    <div style="background: rgba(74, 144, 226, 0.1); padding: 12px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">üõ°Ô∏è</div>
                        <div style="color: #fff; font-weight: 600; font-size: 0.9em;">TCP Sockets</div>
                        <div style="color: #a0b0c8; font-size: 0.75em;">Client/server IPC</div>
                    </div>
                    <div style="background: rgba(74, 144, 226, 0.1); padding: 12px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">üîÑ</div>
                        <div style="color: #fff; font-weight: 600; font-size: 0.9em;">Process Management</div>
                        <div style="color: #a0b0c8; font-size: 0.75em;">Scheduling, synchronization</div>
                    </div>
                </div>
            </div>

        </div>

        <!-- ==================== FOOTER ==================== -->
        <div style="text-align: center; padding: 25px; color: #a0b0c8; border-top: 1px solid rgba(74, 144, 226, 0.2); margin-top: 30px; background: rgba(30, 45, 70, 0.5); border-radius: 8px;">
            <p style="font-size: 1.1em; font-weight: 600; color: #fff;">OS File Server Dashboard v2.0</p>
            <p style="font-size: 0.85em; margin-top: 5px;">üñ•Ô∏è C Server (8888) ‚Üí üêç Flask API (5000) ‚Üí üåê Web Dashboard</p>
            <p style="font-size: 0.75em; margin-top: 10px; color: #6c7a89;">Operating Systems Laboratory Project | Real-time Monitoring & Control</p>
        </div>
    </div>

    <!-- ==================== LOGIN MODAL ==================== -->
    <div id="loginModal" class="modal show">
        <div class="modal-content">
            <h2>üîê Login Required</h2>
            <p style="color: #a0b0c8;">Authenticate to access the dashboard</p>
            <input type="text" id="loginUsername" placeholder="Client ID" value="user1" />
            <input type="password" id="loginPassword" placeholder="Password" value="test123" />
            <button onclick="login()" style="margin-top: 15px; width: 100%;">Login</button>
            <p style="margin-top: 15px; font-size: 0.85em; color: #a0b0c8;">
                Demo credentials:<br>
                admin/password | user1/test123 | user2/secret
            </p>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
